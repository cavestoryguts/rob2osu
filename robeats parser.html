<!DOCTYPE html>
<html>
<head>
<meta charset="ASCII">
<title>RoBeats to osu! Converter (robeats2osu)</title>
</head>
<body> 
<script>

function parser() {

	//make the string blank before the variables realize
    document.getElementById("out").value = "";
    
   	//button function
	document.getElementById("convertButton").innerHTML= "Done!";
    setTimeout(function() {
    	document.getElementById("convertButton").innerHTML = "Convert!";
    }, 1000);
        
	//robeats input variables
	let str = document.getElementById("in").value;
    const array = str.split("\n"); 

	//note section variables
    var start, end = start = 0;
    while (array[start].match(/\);/) != ");") {
    	start++;
    }
    while (array[end].match(/TimingPoints/) != "TimingPoints") {
    	end++;
    }
    
    //timing point variables 
    let timingPointTime = array[end+1].match(/(?<=Time = )(.*?)(?=\,)/)[0] * 1,
    beatLength = array[end+2].match(/(?<=BeatLength = )(.*?)(?=$)/)[0] * 1,
  
    //metadata variables
	title = array[2].match(/(?<=")(.*?)(?= \()/)[0],
	artist = array[5].match(/(?<=")(.*?)(?=")/)[0],
	audioMod = array[10].match(/(?<== )(.*?)(?=,)/)[0],
	difficulty = array[6].match(/(?<== )(.*?)(?=,)/)[0],
	creator = "RoBeatsConverter";

	switch(audioMod) {
		default: audioMod = "Normal"; break;
  		case 1: audioMod = "Hard"; break;
    	case 2: audioMod = "Easy"; break;
	}

	document.getElementById("out").value =
`osu file format v14

[General]
AudioFilename: audio.mp3
AudioLeadIn: 0
PreviewTime: -1
Countdown: 0
SampleSet: Drum
StackLeniency: 0.7
Mode: 3
LetterboxInBreaks: 0
SpecialStyle: 0
WidescreenStoryboard: 0

[Editor]
DistanceSpacing: 1
BeatDivisor: 4
GridSize: 8
TimelineZoom: 2  

[Metadata]
`.concat("Title:",title,"\n","TitleUnicode:",title,"\n","Artist:",artist,"\n","ArtistUnicode:",artist,"\n","Creator:",creator,"\n","Version:",audioMod," [",difficulty,"] \n") + 
`Source:
Tags:
BeatmapID:0
BeatmapSetID:-1

[Difficulty]
HPDrainRate:5
CircleSize:4
OverallDifficulty:5
ApproachRate:5
SliderMultiplier:1.4
SliderTickRate:1

[Events]
//Background and Video events
//Break Periods
//Storyboard Layer 0 (Background)
//Storyboard Layer 1 (Fail)
//Storyboard Layer 2 (Pass)
//Storyboard Layer 3 (Foreground)
//Storyboard Layer 4 (Overlay)
//Storyboard Sound Samples

[TimingPoints]
`.concat(timingPointTime,",",beatLength,",4,3,0,30,1,0 \n\n\n") + 
`[HitObjects]
`;
    

	//note parser loop
	for (let i = start; i <= array.length; i++) {

		let note, time, lane, test, length, tail;
		note = array[i].match(/v\d/); //v1 or v2
      
		if (note[0] == "v2") { //v2 variables

   		time = array[i].match(/(?<=\()(.*?)(?=\,)/)[0] * 1;
    		lane = array[i].match(/(?<= )(.*?)(?=\,)/)[0] * 128-64; 
    		length = array[i].match(/(?<= \d, )(.*?)(?=\))/)[0] * 1;
    		tail = time + length;

			document.getElementById("out").value += "".concat(lane,",192,",time,",128,0,",tail,":0:0:0:0:\n");
    
		} else {
    
    		time = array[i].match(/(?<=\()(.*?)(?=\,)/)[0] * 1;
    		lane = array[i].match(/(?<= )(.*?)(?=\))/)[0] * 128-64;

			document.getElementById("out").value += "".concat(lane,",192,",time,",1,","0,0:0:0:0:\n");
			
  		}
	}
}

</script>
<a href="https://github.com/spotco/RobeatsWebConvert2">Source</a><br/>
	<div><textarea id="in" name="textarea1" style="width:1000px;height:200px">paste robeats script here</textarea>

	<br/><button id="convertButton" onclick="parser()">Convert!</button><br/><br/><br/><br/>  
            
	<textarea id="out" style="width:1000px;height:200px" readonly>osu! output</textarea>
	<p id="instructions">Make a new folder and make a .osu file (with any name) and the audio you just downloaded in it.</p>
	</div>
</body>
</html>
